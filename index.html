<html>
<head>
  <title>
    My Map
  </title>
  <!--Leaflet-->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://raw.githubusercontent.com/alaattinyilmaz/risk-game/master/map/lib/leaflet/leaflet.label.css"/>
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
  <script src="https://raw.githubusercontent.com/alaattinyilmaz/risk-game/master/map/data/countries.geojson"></script>
  <script src="https://raw.githubusercontent.com/alaattinyilmaz/risk-game/master/map/lib/leaflet/leaflet.label.js"></script>
  <style>
  #map{height : 100%;width :100%;}
  .legend {background : white; line-height: 1.5em}
  .legend i {width: 5em; float : left }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>


  var countriesLayer; // layer for the map


  // highlight feature function
  function highlightFeature(e)
  {
    // üzerine geldiğinde highlightlıyor.
    var layer = e.target;
    layer.setStyle(
      {
      weight : 5,
      color : 'black',
      fillColor : 'white',
      fillOpacity : 0.2
      }
    );
    if(!L.Browser.ie && !L.Browser.opera)
    {
      layer.bringToFront();
    }
  }


  // reset hightlight function
  function resetHighlight(e)
  {
    countriesLayer.resetStyle(e.target);
    //mouse üzerinden gittiğinde highlightı kaldırıyor.
  }

  // zoom to feature
  function zoomToFeature(e)
  {
    //üzerine tıklandığında zoomluyor
    map.fitBounds(e.target.getBounds());
  }

  // !!! On each feature function
  function countriesOnEachFeature(feature, layer)
  {
    //layer.bindLabel(feature.properties.POP_EST.toString(),{noHide : true});
    // her bir feature(country) ile işlem yapıldığında çağırılacak fonksiyon
    layer.on(

      {
        mouseover : highlightFeature, // mouse hoverlayınca
        mouseout : resetHighlight, // hover kalkınca
        click : zoomToFeature // clickleyince
        // bunlara basınca üstteki fonsksiyonları çağırıyor
      }
    )
    layer.bindPopup(feature.properties.SOVEREIGNT);
    layer.bindPopup(
      '<div><img src="https://i.pinimg.com/736x/1f/4f/ac/1f4facc71a8ab071c2da148adc7bd3b2--toy-soldiers-napoleonic-wars.jpg" alt = "image" width=50px height=100px/></div>'
    );



    //https://wiki.teamfortress.com/w/images/thumb/7/7b/Soldier.png/250px-Soldier.png
    //  her feature için SOVEREIGNT isimli özelliğini bastırıyor
  }

  // country color function
  // geoJsondan gelen her feature(country)i populasyonlarına göre renklendiriyor
  function getCountryColor(popEst)
  {
    //console.log(popEst); <-- was for debugging
    if(popEst > 100000000)
    {
      return 'red';
    }
    else if(popEst > 50000000)
    {
      return 'blue';
    }
    else
    {
      return 'green';
    }
  }
// countries style function
  function countriesStyle(feature)
  {
    return{
      fillColor : getCountryColor(feature.properties.POP_EST),// renk fonksiyonunu çağırıyor
      weight : 2,
      opacity : 1,
      color : 'white',
      dashArray : 3,
      fillOpacity : 0.7
    }
  }

  var map = L.map('map').setView([43.8476, 18.3564], 6); // map merkezi ve zoom değeri ayarlanıyor
  countriesLayer = L.geoJson( // leafletin fonksiyonu, geojson dosyasını
    countries, // countries variableı geoJson dosyasını referans almak için, geoJson dosyasının ilk satırında görülebilir
    {
      style : countriesStyle, // style için üstte yazılmış olan fonsksiyonu çağırıyor
      onEachFeature : countriesOnEachFeature // her bir featureda, countriesOnEachFeature fonksiyonunu çağırıyor.
    }
  ).addTo(map);//mape ekliyor

  var legend = L.control({position : 'bottomright'}); // lejant eklemek için
  legend.onAdd = function(map)
  {
    var div = L.DomUtil.create('div','legend');
    var labels = ["Populations greater than 100000000",
    "Populations greater than 50000000",
    "Populations equal or less than 50000000"];

    var grades = [100000001,50000001,50000000];
    div.innerHTML = '<div><b>Legend</b></div>';
    for(var i=0;i<grades.length;i++)
    {
      div.innerHTML += '<i style= "background:'
      + getCountryColor(grades[i]) + '">&nbsp;&nbsp;</i>&nbsp&nbsp;'
      + labels[i]+ '<br/>';
    }
    return div;
  }
  //legend.addTo(map);


  // marker
  /*var point = [43.866667, 18.416667];
  var myMarker = L.marker(point);
  myMarker.addTo(map);
  myMarker.bindPopup(
    '<b> Sarajevo</b>'
  )*/

  // to create custom icon for markers
  /*var greenIcon = L.icon(
     {
       iconURL : 'http://leafletjs.com/docs/images/leaf-green.png',
       shadowURL : 'http://leafletjs.com/docs/images/leaf-shadow.png',
       iconSize : [38 ,95],
       shadowSize : [50,64],
       iconAnchor : [22,94],
       shadowAnchor : [4,62],
       popupAnchor : [-3,-76]
     }
   );
   var marker = L.marker(point,{icon : greenIcon}).addTo(map);*/





  //var marker = L.marker(point).addTo(map);//default marker icon

  /*var circle = L.circle( // circle marker icon
    point,
    10000,
    {
      color :'purple',
      fillColor : 'red',
      fillOpacity : 0.8
    }
  ).addTo(map);*/

  /*
  map.on('click', function(e) {
    console.log(e); // to see the values of the geojson objects in console
  });
  */
  </script>
</body>
</html>
